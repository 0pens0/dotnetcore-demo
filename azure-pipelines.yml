

stages:
  - stage: Build
    jobs:
      - job: compile
        steps:
          - script: ./build.sh Publish --skip
          - script: ./build.sh Pack --skip
          - task: PublishPipelineArtifact@0
            inputs:
              targetPath: $(Build.ArtifactStagingDirectory)
              artifactName: artifact
          - task: PublishPipelineArtifact@0
            inputs:
              targetPath: $(System.DefaultWorkingDirectory)
              artifactName: build
  - stage: Dev
    jobs:
      - deployment: Dev
        environment: Dev
        strategy:
          runOnce:
            deploy:
              steps:
                - download: none
                - task: DownloadPipelineArtifact@2
                  inputs:
                    artifact: build
                    targetPath: '$(System.DefaultWorkingDirectory)'
                - task: DownloadPipelineArtifact@2
                  inputs:
                    artifact: build
                    targetPath: '$(Build.ArtifactStagingDirectory)' 
                - script: chmod +x build.sh
                - script: ./build.sh CfLogin --skip
                  # env:
                  #   CfLogin: $(CfLogin)
                  #   CfPassword: $(CfPassword)
                  #   CfOrg: $(CfOrg)
                  #   CfSpace: $(CfSpace)
                  #   CfApi: $(CfApi)
                - script: ./build.sh Deploy --skip
                  # env:
                  #   CfLogin: $(CfLogin)
                  #   CfPassword: $(CfPassword)
                  #   CfOrg: $(CfOrg)
                  #   CfSpace: $(CfSpace)
                  #   CfApi: $(CfApi)
