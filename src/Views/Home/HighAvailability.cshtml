<div class="row">
	<div class="col-xl-6">
		<div class="card shadow mb-4">
        	<div class="card-header py-3">
        		<h6 class="m-0 font-weight-bold text-primary">Scale & High Availability</h6>
        	</div>
        	<div class="card-body">
        		<p class="alert-warning">
        			Attention! Before clicking on kill you may want to ensure you have at least 2 application instances (HA)
        			configured. Otherwise be ready to wait a minute or so until PCF auto-recovers the application.
        		</p>
        		<p>
        			The application instance and container showed is not the one necessarily being killed (unless you have one instance, of course). PCF will load balance the request,
        			however, we designed the application to return with the application information prior to terminating itself.
        		</p>
        		<a href="#" class="btn btn-primary btn-icon-split">
        			<span class="icon text-white-50">
        				<i class="fas fa-flag"></i>
        			</span>
        			<span class="text">Start load test</span>
        		</a>
        		<a href="#" class="btn btn-danger btn-icon-split">
        			<span class="icon text-white-50">
        				<i class="fas fa-trash"></i>
        			</span>
        			<span class="text">Kill</span>
        		</a>
        	</div>
        </div>
	</div>
	<div class="col-xl-6">
		<div class="card shadow mb-4">
			<div class="card-header py-3">
				<h6 class="m-0 font-weight-bold text-primary">Load Distribution</h6>
			</div>
			<div class="card-body">
				<p><b>Hi</b> - <span id="blink">45%</span> </p>
			</div>
		</div>
	</div>
</div>



<script>
var INTERVAL = 1000;
var timerID = 0;
var load = {};
var total = 0;

function toggleTimer() {
	if (timerID == 0) {
		startTimer();
		$('#loadButton').text("Stop Load Test");
	} else {
		stopTimer();
		$('#loadButton').text("Start Load Test");
	}
}

function startTimer() {
	timerID = setInterval(startLoad, INTERVAL);
}

function stopTimer() {
	if (timerID) {
		clearInterval(timerID);
		timerID = 0;
	}
	total = 0;
	load = {};
}

function startLoad() {

	$.get("/bluegreen-check", function(appEnv) {

		total++;

		var appName = appEnv[0]
		var appIndex = appEnv[1]

		var appKey = appName + '-' + appIndex

		if (appKey in load) {
			load[appKey] = 1 + load[appKey];
		} else {
			load[appKey] = 1;
		}

		var html = '<h4>Load Distribution</h4>';

		// MMB: This can be templated instead of creating HTML in the function
		for (appKey in load) {

			value = (load[appKey] / total) * 100;

			html += '<p><b>' + appKey + '</b> - <span id="blink">'
					+ value + '% </span> </p>'
		}

		if (timerID != 0) {
			$('#loadResults').html(html);
		}

	});

}
</script>